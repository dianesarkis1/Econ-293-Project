knitr::opts_chunk$set(echo = TRUE)
library(haven)
data <- read_dta("Desktop/Replication_Dataset copy.dta")
Y <- data$vote_lega_euro
W <- data$dummy_euro_4
covariates <- c("age", "factor(eco_mode)", "vote_lega_municipal", "EDU1", "EDU2", "EDU3",
"INC1", "INC2", "INC3", "INC4", "INC5", "INC6", "INC7", "INC8", "INC9", "INC10", "INC11", "INC12",
"INC13", "INC14", "INC15", "INC16","everyweek", "female", "gov_firms_responsibility",
"green_policies_positive", "climate_neutrality", "km_1k_to_5k", "km_5k_to_10k",
"km_10k_to_20k", "km_20k_to_30k", "km_less_1k", "km_more_30k", "pay_eco_friendly",
"factor(recycled_materials)", "taxes_eco_friendly", "use_month", "use_week", "use_year",
"water_bottle")
X <- model.matrix(formula(paste0("~", paste0(covariates, collapse="+"))), data=data)
X <- X[, -1]
#Note that INC15 is a dummy if income question does not apply, and INC16 is prefer not to respond
W_formula <- as.formula(paste("W ~", paste(covariates, collapse="+")))
# Fit the logistic regression model
W_model <- glm(W_formula, family=binomial(link="logit"), data=data)
# Obtain predicted probabilities of treatment
W_hat <- predict(W_model, type="response")
# Define the outcome model
Y_formula <- as.formula(paste("Y ~ W +", paste(covariates, collapse="+")))
# Fit the linear regression model
Y_model <- glm(Y_formula, data=data)
# Obtain predicted outcomes
Y_hat <- predict(Y_model)
# Compute weights for AIPW
weights <- ifelse(W==1, 1/W_hat, 1/(1-W_hat))
# Compute AIPW estimate of ATE
ATE_AIPW <- mean((W - W_hat)*(Y - Y_hat)*weights + W_hat*Y_hat - (1-W_hat)*(1-Y_hat)*weights)
ATE_AIPW
knitr::opts_chunk$set(echo = TRUE)
library(haven)
data <- read_dta("Replication_Dataset copy.dta")
library(haven)
data <- read_dta("Replication_Dataset.dta")
Y <- data$vote_lega_euro
W <- data$dummy_euro_4
covariates <- c("age", "factor(eco_mode)", "vote_lega_municipal", "EDU1", "EDU2", "EDU3",
"INC1", "INC2", "INC3", "INC4", "INC5", "INC6", "INC7", "INC8", "INC9", "INC10", "INC11", "INC12",
"INC13", "INC14", "INC15", "INC16","everyweek", "female", "gov_firms_responsibility",
"green_policies_positive", "climate_neutrality", "km_1k_to_5k", "km_5k_to_10k",
"km_10k_to_20k", "km_20k_to_30k", "km_less_1k", "km_more_30k", "pay_eco_friendly",
"factor(recycled_materials)", "taxes_eco_friendly", "use_month", "use_week", "use_year",
"water_bottle")
X <- model.matrix(formula(paste0("~", paste0(covariates, collapse="+"))), data=data)
X <- X[, -1]
W_formula <- as.formula(paste("W ~", paste(covariates, collapse="+")))
# Fit the logistic regression model
W_model <- glm(W_formula, family=binomial(link="logit"), data=data)
# Obtain predicted probabilities of treatment
W_hat <- predict(W_model, type="response")
# Define the outcome model
Y_formula <- as.formula(paste("Y ~ W +", paste(covariates, collapse="+")))
# Fit the linear regression model
Y_model <- glm(Y_formula, data=data)
# Obtain predicted outcomes
Y_hat <- predict(Y_model)
# Compute weights for AIPW
weights <- ifelse(W==1, 1/W_hat, 1/(1-W_hat))
# Compute AIPW estimate of ATE
ATE_AIPW <- mean((W - W_hat)*(Y - Y_hat)*weights + W_hat*Y_hat - (1-W_hat)*(1-Y_hat)*weights)
ATE_AIPW
